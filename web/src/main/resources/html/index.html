<html ng-app="myApp">
<head>
    <style>
        #colored {
            background-color: #b0c4de;
        }
    </style>
    <script src="https://code.angularjs.org/1.3.6/angular.js"></script>
    <script src="https://code.angularjs.org/1.3.6/angular.min.js.map"></script>

    <script>
        var appModule = angular.module('myApp', []);

        appModule.controller('rest',function($scope, $http) {
            $scope.selected = {};
            $http.get('http://localhost:8080/newvalia/product/findAll').
                    success(function(data) {
                        $scope.products = data;
                    }).error(function(data) {
                        console.log("error");
                    });
        });

        appModule.controller('saveProductController',function($scope, $http) {
            $scope.submit = function() {
                console.log('$scope.shop' ,$scope.shop);
                console.log('$scope.shop.value' ,$scope.shop.value);
                $http.post('http://localhost:8080/newvalia/product/save',
                        {"name": $scope.nameProduct,"shopList":[{"name":$scope.shop.id,"productAttr":[{"price":$scope.price,"date":$scope.date}]}]}).


                        success(function(data, status, headers, config) {
                            // this callback will be called asynchronously
                            // when the response is available
                        }).
                        error(function(data, status, headers, config) {
                            // called asynchronously if an error occurs
                            // or server returns response with an error status.
                        });
            };
            $http.get('http://localhost:8080/newvalia/shop/findAll').
                    success(function(data) {
                        $scope.shops = data;
                        console.log("out shop", $scope.shops);
                    }).error(function(data) {
                        console.log("error");
                    });
        });


        appModule.controller('rest',function($scope, $http) {
            $scope.selected = {};
            $scope.selectedShop = {};
            $http.get('http://localhost:8080/newvalia/product/findAll').
                    success(function(data) {
                        $scope.products = data;
                        console.log("out ", $scope.products);
                    }).error(function(data) {
                        console.log("error");
                    });



        });

        appModule.controller('saveShopController',function($scope, $http) {
            $scope.submitShop = function() {
                //
                $http.post('http://localhost:8080/newvalia/shop/save',
                        {"name": $scope.nameShop, "id": $scope.nameShop}).
                        success(function(data, status, headers, config) {
                            // this callback will be called asynchronously
                            // when the response is available
                        }).
                        error(function(data, status, headers, config) {
                            // called asynchronously if an error occurs
                            // or server returns response with an error status.
                        });
            };
        });
    </script>
</head>

<body>
<form ng-submit="submitShop()" ng-controller="saveShopController">
    <table>
        <tr>
            <td>Shop name:</td><td> <input type="text" ng-model="nameShop"  /></td>
        </tr>

        <tr>
            <td><input type="submit" id="submitShop" value="Submit" /></td>
        </tr>
    </table>
</form>

<form ng-submit="submit()" ng-controller="saveProductController">
    <table>
        <tr>
            <td>Product name:</td><td> <input type="text" ng-model="nameProduct"  /></td>
        </tr>
        <tr>
            <td>Price: </td><td> <input type="text" ng-model="price" /></td>
        </tr>
        <tr>
            <td>Buy Date: </td><td> <input type="date" ng-model="date" placeholder="dd-MM-yyyy" required /></td>
        </tr>

        <tr>
            <td>Shop: </td><td><select ng-model="shop" ng-options='shop.name for shop in shops'></select></td>
        </tr>

        <tr>
            <td><input type="submit" id="submit" value="Submit" /></td>
        </tr>
    </table>
</form>
<div ng-controller="rest">
    <table border="1"  ng-repeat="module in products">
        <tr>
            <td>
                {{module.name}}
            </td>
            <td>
        <tr ng-repeat="col in module.shopList">
            <td>
                {{col.name}}
            </td>
            <td><select ng-model="selected.value" ng-options='pp.total as (  (pp.date | date:"dd/MM/yyyy") + ", "+ pp.price) for pp in col.productAttr'></select>
            </td>
        </tr>
        </td>
        </tr>
    </table>
</div>
</body>

</html>